# Инструкция по разработке на DJANGO

---

### Создание проекта

В Django существует 2 основных понятия:
* ```менеджер``` - зависящая от приложений сущность, для управления приложениями и их взаимодействием
* ```приложение``` - обособленная часть кода, выполняющая определенную задачу и цель


Для создания менеджера используется команда:
```bash
django-admin startproject manage_app .
```

Для запуска сервера используется команда:
```bash
python manage.py runserver
```


Для создания приложения используется команда:
```bash
python manage.py startapp first_app
```

---


### Работа с приложением

Django реализует паттерн MNC(Model View Controller):
* ```Model [Модель]``` - сущности для работы с данными (получение из БД, их преобразование, запись, удаление, редактирование)
* ```View [Представление]``` - сущность для отображения данных без логики (отображение на странице)
* ```Controller [Контроллер]``` - сущность - посредник между данными и отображением, не должен содержать логики


Для создания страницы следует выполнить следующие шаги:
1. Создать функцию в ```views.py``` в риложении, которая вернет представление страницы
```python
from datetime import date

from django.http import HttpResponse
from django.shortcuts import render


# Create your views here.
def current_date(request):
    return HttpResponse(f'<h1>{date.today()}</h1>')
```
2. В файле ```urls.py``` добавить маршрут (может не быть в приложении, нужно создать)
```python
from django.urls import path
from first_app import views

urlpatterns = [
    path('', views.current_date, name='current_date')
]
```
3. В менеджере приложений, в файле ```urls.py``` (в папке manage_app) добавить созданные маршруты

```python
from django.contrib import admin
from django.urls import path, include

urlpatterns = [
    path('admin/', admin.site.urls),
    path('', include('first_app.urls'))
]
```
---

### Виды ответов

* ```JsonResponse``` - возвращает ответ в виде JSON
* ```HttpResponse``` - возвращает ответ в виде HTML или HTTP-кода


---

### Создание шаблонов

```Шаблон``` - html-код страницы с возможностью использования python-кода или в виде директив (if, for, block). 
Допускает расширение.  
```Статика (статичный контент)``` - неизменяемый во времени дополнительный контент страницы (css, js, картинки, видео и т.д.)


Шаблоны бывают: 
* ```Базовыми``` - неизменяемый каркас страницы с областями для вставки динамической области (Block)
* ```Расширяемый``` - динамическая составляющая конкретной страницы.


Для создания шаблона необходимо:
1. В папке с приложением создать папки ```templates``` (шаблон) и ```static``` (статичный контент).
2. В папке ```static``` создать папки категории (css, js, image и т.д.). При необходимости добавить смысловые папки для каталогизации (добавить папки для удобства).
3. Создать статичный контент в папках.
4. В папке шаблонов ```templates``` создать дополнительные папки (по необходимости).
5. Создать базовый шаблон.
6. Создать расширяемые шаблоны.

---

### Добавление приложений в менеджер приложений

В менеджере приложений в файле ```settings.py``` необходимо добавить приложение в переменную ```INSTALLED_APPS``` в виде строки ```'<название папки с приложением>.apps.<название класса из файла apps.py папки приложения>'```

```python
# Application definition

INSTALLED_APPS = [
    'first_app.apps.FirstAppConfig',
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
]
```

---

### Директивы шаблонизатора

```Директива``` - команда шаблонизатора для выполнения определенной логики.  

Директивы можно писать в ```{% <директива> %}``` или ```{{ <директива> }}```

Доступные директивы:  
* ```{% load static %}``` - загрузка статичного контента.  
* ```{% static '<путь к файлу статики в папке static>' %}``` - путь к статическому контенту
* Оператор ветвления, обязательно должен оканчиваться ```{% endif %}```:
```
    {% if title %}
        если правда
    {% else %}
        если не правда (необязательный блок)
    {% endif %} 
  ```
* ```{% url '<название маршрута>' %}``` - создание ссылки на именованный маршрут ("name=..." в path), указание имени несуществующего маршрута приведет к ошибке.
* ```{% block <название блока> %}{% endblock %}``` -
в базовом шаблоне - это изменяемая область (динамическая часть), а в наследуемом - контент изменяемой области.
* ```{% extends '<путь к базовому шаблону>' %}``` - наследование (расширение) базового шаблона
* Цикл (перебор):
```
{% for item in <имя итерируемого объекта> %}
    <код отрисовки одного элемента>
{% endfor %}
```

---

### Отрисовка шаблона

Для отрисовки шаблона на странице необходимо в функции представления (второй аргумент функции ```path```, хранятся в папке приложения ```views.py```):   
```python
from django.shortcuts import render

def <название страницы>_page(request):
    return render(request, '<путь до шаблона в папке templates>example/about.html', {<словарь с контекстом>})
```

```Контекст``` - словарь, где ключ - имя переменной, а значение - значение этой переменной.
Содержит в себе переменные, которые доступны в шаблоне. Контекст не является обязательной переменной функции ```render```.


---

### Подключение к БД

В файле ```settings.py``` нашего менеджера приложений в переменной ```DATABASES``` нужно заменить код на 
```python
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql', # Драйвер для подключения (postgresql)
        'NAME': 'first_app', # Имя БД
        'USER': 'postgres',# Пользователь
        'PASSWORD': 'root', # Пароль
        'HOST': 'localhost', # Хост
        'PORT': '',
    }
}
```
И через СУБД создать БД с именем из ```NAME```.

Для запуска миграции необходимо выполнить в терминале команду (может выйти ошибка, если надо установить псайкопг: прописать - pip install psycopg2):
```bash
python manage.py migrate
```

---

###  Доступ к админке

Для доступа к админке нужно перейти по адресу <a href="http://localhost:8000/admin">адресу</a>

Для воздания пользователя необходимо выполнить команду:
```bash
python manage.py createsuperuser
```
и следовать указаниям.

Для изменения пароля пользователя используется команда:
```bash
python manage.py changepassword <имя пользователя>
```
(имя: adele  
емаил: обычный  
пароль: adel150198  
пароль для юзеров root@123)


---

### Работа с моделями

Модели хранятся в папке приложения в файле ```models```. 
Все модели должны быть унаслеованы от:
```django.db.models.Model```.
Свойства класса модели в последствии станут колонками в таблице.
```python
from django.db import models
from django.utils import timezone
from django.contrib.auth.models import User

# Create your models here.

# Класс модели
class Post(models.Model):
    # Поля модели
    title = models.CharField(max_length=100)
    content = models.TextField()
    date_create = models.DateTimeField(default=timezone.now)
    author = models.ForeignKey(User, on_delete=models.CASCADE)

    # Представление модели в виде строки
    def __str__(self):
        return self.title
```

```Модель``` - это классовое представление конкретной таблицы в Python, 
где свойства класса - это колонка в таблице, а конкретный экземпляр - конкретная запись в БД.

После изменений моделей обязательно выполнять команду создания миграции
```bash
python manage.py makemigrations
```

Они отображаются в папке приложения с именем ```migrations```

Для применения миграции используется команда
```bash
python manage.py migrate
```

Для отображения модели в админке, необходимо в файле папки приложения ```admin.py```
ее зарегистрировать:
```python
from django.contrib import admin

from .models import Post

# Register your models here.
admin.site.register(Post)
```




